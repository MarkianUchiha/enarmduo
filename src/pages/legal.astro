---
import Layout from '../layouts/Layout.astro';
import Header from '../components/core/Header.astro';
import Footer from '../components/core/Footer.astro';
import { getCollection } from 'astro:content';

// Obtener todos los documentos legales de la colección
const legalDocs = await getCollection('legal');
---

<Layout title="EnarmDuo - Términos Legales">
	<Header />
	<div class="min-h-screen w-full flex flex-col items-center justify-center p-12 m-8 bg-gray-50">
		<div class="w-full max-w-6xl">
			<!-- Contenedor de botones -->
			<div class="flex flex-col md:flex-row gap-4 w-full" style="height: 30vh;">
				<!-- Botón 1: Términos y Condiciones -->
				<button 
					id="btn-terminos"
					class="legal-btn flex-1 bg-white shadow-lg hover:shadow-xl transition-shadow duration-300 rounded-xl p-6 text-lg font-semibold text-gray-800 border-2 border-transparent hover:border-blue-300 cursor-pointer active:scale-95 transition-transform"
					data-tipo="terminos-condiciones"
					data-slug="terminos-condiciones"
				>
					Términos y Condiciones
				</button>

				<!-- Botón 2: Políticas de Privacidad -->
				<button 
					id="btn-privacidad"
					class="legal-btn flex-1 bg-white shadow-lg hover:shadow-xl transition-shadow duration-300 rounded-xl p-6 text-lg font-semibold text-gray-800 border-2 border-transparent hover:border-blue-300 cursor-pointer active:scale-95 transition-transform"
					data-tipo="politicas-privacidad"
					data-slug="politicas-privacidad"
				>
					Políticas de Privacidad
				</button>

				<!-- Botón 3: Aviso de Privacidad -->
				<button 
					id="btn-aviso"
					class="legal-btn flex-1 bg-white shadow-lg hover:shadow-xl transition-shadow duration-300 rounded-xl p-6 text-lg font-semibold text-gray-800 border-2 border-transparent hover:border-blue-300 cursor-pointer active:scale-95 transition-transform"
					data-tipo="aviso-privacidad"
					data-slug="aviso-privacidad"
				>
					Aviso de Privacidad
				</button>
			</div>

			<!-- Área de contenido -->
			<div id="contenido-container" class="w-full mt-12 pt-12 bg-white rounded-xl shadow-lg p-8 min-h-[50vh] border-2 border-gray-100 hidden">
				<div id="contenido-texto" class="prose max-w-none text-gray-700 leading-relaxed"></div>
			</div>
		</div>
	</div>
	<Footer />

	<script define:vars={{ legalDocs }}>
		// Convertir documentos a un objeto accesible
		// @ts-ignore - Definición global para contenido legal
		window.contenidosLegales = {};
		
		legalDocs.forEach(doc => {
			// @ts-ignore
			window.contenidosLegales[doc.id] = doc.body;
		});
	</script>
	
	<script>
		// Función para mostrar contenido
		function mostrarContenido(slug: string) {
			const container = document.getElementById('contenido-container');
			const texto = document.getElementById('contenido-texto');
			const botones = document.querySelectorAll('.legal-btn');

			if (!container || !texto) return;

			// Ocultar contenedor si está vacío
			if (container.classList.contains('hidden')) {
				container.classList.remove('hidden');
			}

			// Actualizar contenido
			// @ts-ignore - Contenido legal está definido en window
			const contenido = window.contenidosLegales?.[slug];
			texto.innerHTML = contenido || '';

			// Actualizar estado visual de botones
			botones.forEach(boton => {
				boton.classList.remove('border-blue-500', 'bg-blue-50');
				boton.classList.add('border-transparent');
			});

			const botonActivo = document.querySelector(`[data-slug="${slug}"]`);
			if (botonActivo) {
				botonActivo.classList.remove('border-transparent');
				botonActivo.classList.add('border-blue-500', 'bg-blue-50');
			}

			// Scroll suave hacia el contenido con offset para el header
			const headerOffset = 80; // Ajustar según el tamaño del header
			const elementPosition = container.getBoundingClientRect().top;
			const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

			window.scrollTo({
				top: offsetPosition,
				behavior: 'smooth'
			});
		}

		// Agregar event listeners cuando el DOM esté listo
		document.addEventListener('DOMContentLoaded', () => {
			const botones = document.querySelectorAll('.legal-btn');
			
			botones.forEach(boton => {
				boton.addEventListener('click', () => {
					const slug = boton.getAttribute('data-slug');
					if (slug) {
						mostrarContenido(slug);
					}
				});
			});

			// Mostrar primer contenido por defecto
			mostrarContenido('terminos-condiciones');
		});
	</script>
</Layout>

<style>
	/* Estilos para móvil */
	@media (max-width: 768px) {
		.legal-btn {
			min-height: 100px;
		}
	}

	/* Estilos para desktop/tablet */
	@media (min-width: 769px) {
		.legal-btn {
			min-height: 100px;
		}
	}
</style>
